<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Sound Box</title>
</head>

<body>
    <script type="x-shader/x-vertex" id="vertexShader">

        attribute vec3 center;
        varying vec3 vCenter;
        uniform float time;

        // Simple 2D noise function
        vec2 hash(vec2 p) {
            p = vec2(dot(p, vec2(127.1, 311.7)), dot(p, vec2(269.5, 183.3)));
            return -1.0 + 2.0 * fract(sin(p) * 43758.5453123);
        }

        float rand(vec2 c){
            return fract(sin(dot(c.xy ,vec2(12.9898,78.233))) * 43768.5453);
        }

        float noise(vec2 p, float freq ){
            float unit = 120.0/freq;
            vec2 ij = floor(p/unit);
            vec2 xy = mod(p,unit)/unit;
            //xy = 3.*xy*xy-2.*xy*xy*xy;
            xy = .5*(1.-cos(3.1514*xy));
            float a = rand((ij+vec2(0.,0.)));
            float b = rand((ij+vec2(1.,0.)));
            float c = rand((ij+vec2(0.,1.)));
            float d = rand((ij+vec2(1.,1.)));
            float x1 = mix(a, b, xy.x);
            float x2 = mix(c, d, xy.x);
            return mix(x1, x2, xy.y);
        }

        float pNoise(vec2 p, int res){
            float persistance = .5;
            float n = 0.;
            float normK = 0.;
            float f = 4.;
            float amp = 1.;
            int iCount = 0;
            for (int i = 0; i<50; i++){
                n+=amp*noise(p, f);
                f*=2.;
                normK+=amp;
                amp*=persistance;
                if (iCount == res) break;
                iCount++;
            }
            float nf = n/normK;
            return nf*nf*nf*nf;
        }

        void main() {

            vCenter = center;
            vec3 displacedPosition = position;
            float displacement = pNoise(position.xy * 0.1 + vec2(time * 2.0, time * 2.0), 1);
            displacedPosition.z += displacement * 200.0 + 6.0;

            // Apply transformations
            gl_Position = projectionMatrix * modelViewMatrix * vec4(displacedPosition, 1.0);
        }
		</script>

    <script type="x-shader/x-fragment" id="fragmentShader">

			
        uniform float thickness;

			varying vec3 vCenter;
            uniform vec3 color_1;
            uniform vec3 color_2;

			void main() {

				vec3 afwidth = fwidth( vCenter.xyz );

				vec3 edge3 = smoothstep( ( thickness - 0.5 ) * afwidth, (thickness + 0.5) * afwidth, vCenter.xyz );

				float edge = 1.0 - min( min( edge3.x, edge3.y ), edge3.z );

				gl_FragColor.rgb = edge < 1.0 ? color_2 : color_1;
				gl_FragColor.a = 1.0;

			}

		</script>
    <script type="importmap">
        {
          "imports": {
            "three": "https://unpkg.com/three@0.160.1/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.1/examples/jsm/"
          }
        }
        
    </script>
    <div class="toolbar_container">
        <div class="dropup">
            <button class="dropbtn leftbtn">Shape</button>
            <div class="dropup-content">
                <button style="background-color: rgb(190, 142, 253);" class="colorbtn" value="0"></button>
                <button style="background-color: rgb(214, 69, 69);" class="colorbtn" value="1"></button>
                <button style="background-color: rgb(180, 189, 54);" class="colorbtn" value="2"></button>
                <button style="background-color: rgb(40, 112, 88);" class="colorbtn" value="3"></button>
            </div>
        </div>
        <div class="dropup">
            <button class="dropbtn middlebtn">Color</button>
            <div class="dropup-content">
                <button style="background-color: rgb(190, 142, 253);" class="colorbtn" value="0"></button>
                <button style="background-color: rgb(214, 69, 69);" class="colorbtn" value="1"></button>
                <button style="background-color: rgb(180, 189, 54);" class="colorbtn" value="2"></button>
                <button style="background-color: rgb(40, 112, 88);" class="colorbtn" value="3"></button>
            </div>
        </div>
        <div class="dropup">
            <button class="dropbtn middlebtn">Texture</button>
            <div class="dropup-content">
                <button style="background-color: rgb(190, 142, 253);" class="colorbtn" value="0"></button>
                <button style="background-color: rgb(214, 69, 69);" class="colorbtn" value="1"></button>
                <button style="background-color: rgb(180, 189, 54);" class="colorbtn" value="2"></button>
                <button style="background-color: rgb(40, 112, 88);" class="colorbtn" value="3"></button>
            </div>
        </div>
        <div class="dropup">
            <button class="dropbtn rightbtn">Other</button>
            <div class="dropup-content">
                <button style="background-color: rgb(190, 142, 253);" class="colorbtn" value="0"></button>
                <button style="background-color: rgb(214, 69, 69);" class="colorbtn" value="1"></button>
                <button style="background-color: rgb(180, 189, 54);" class="colorbtn" value="2"></button>
                <button style="background-color: rgb(40, 112, 88);" class="colorbtn" value="3"></button>
            </div>
        </div>
    </div>
    <script type="module" src="scene.js"></script>
    <script type="module" src="gui.js"></script>
</body>

</html>